# üîî Supabase Realtime –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ Telegram —Ç–æ–≤–∞—Ä—ã —Å–ø–∏—Å—ã–≤–∞–ª–∏—Å—å –≤ –ë–î, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ —Å—Ç–∞—Ä—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∫–µ—à–∞ (2-3 –º–∏–Ω—É—Ç—ã).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: Supabase Realtime

Realtime –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—É—á–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –ë–î –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–µ—à.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ
‚îÇ  (–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Edge Function         ‚îÇ
‚îÇ   confirm-order         ‚îÇ
‚îÇ   ‚îú‚îÄ UPDATE orders      ‚îÇ‚óÑ‚îÄ‚îÄ‚îê
‚îÇ   ‚îÇ  SET status='confirmed' ‚îÇ
‚îÇ   ‚îî‚îÄ –°–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤   ‚îÇ   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                              ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ Realtime Event
         ‚îÇ (postgres_changes)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend              ‚îÇ
‚îÇ   (useOrderRealtime)    ‚îÇ
‚îÇ   ‚îú‚îÄ –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ   ‚îÇ
‚îÇ   ‚îú‚îÄ invalidateAllProducts()
‚îÇ   ‚îî‚îÄ –û–±–Ω–æ–≤–∏—Ç—å UI       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TanStack Query        ‚îÇ
‚îÇ   ‚îú‚îÄ –ö–µ—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω  ‚îÇ
‚îÇ   ‚îî‚îÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ    ‚îÇ
‚îÇ      –æ—Å—Ç–∞—Ç–∫–∏            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

**–§–∞–π–ª:** `supabase/migrations/20260108042735_enable_realtime_for_orders.sql`

```sql
-- –í–∫–ª—é—á–∞–µ–º Realtime –¥–ª—è orders
ALTER PUBLICATION supabase_realtime ADD TABLE orders;
ALTER TABLE orders REPLICA IDENTITY FULL;

-- –í–∫–ª—é—á–∞–µ–º Realtime –¥–ª—è guest_checkouts
ALTER PUBLICATION supabase_realtime ADD TABLE guest_checkouts;
ALTER TABLE guest_checkouts REPLICA IDENTITY FULL;

-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–ª—è products (–ø—Ä—è–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–º)
ALTER PUBLICATION supabase_realtime ADD TABLE products;
ALTER TABLE products REPLICA IDENTITY FULL;
```

### 2. –ö–æ–º–ø–æ–∑–∞–±–ª –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫

**–§–∞–π–ª:** `composables/useOrderRealtime.ts`

```typescript
export function useOrderRealtime() {
  const supabase = useSupabaseClient()
  const { invalidateAllProducts } = useProductCacheInvalidation()

  function subscribeToOrders() {
    supabase
      .channel('orders-realtime')
      .on('postgres_changes', {
        event: 'UPDATE',
        schema: 'public',
        table: 'orders',
        filter: 'status=eq.confirmed', // –¢–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ
      }, (payload) => {
        console.log('üîî Order confirmed:', payload.new.id)
        invalidateAllProducts() // –û–±–Ω–æ–≤–∏—Ç—å –∫–µ—à
      })
      .subscribe()
  }

  function subscribeToGuestCheckouts() {
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è guest_checkouts
  }

  return {
    subscribeAll,
    unsubscribe,
  }
}
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ app.vue

**–§–∞–π–ª:** `app.vue`

```vue
<script setup>
import { useOrderRealtime } from '@/composables/useOrderRealtime'

const { subscribeAll, unsubscribe } = useOrderRealtime()

onMounted(() => {
  subscribeAll() // –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
})

onUnmounted(() => {
  unsubscribe() // –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
})
</script>
```

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ Telegram

1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" –≤ Telegram
2. **Edge Function** `confirm-order` –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å:
   ```sql
   UPDATE orders SET status = 'confirmed' WHERE id = '...'
   ```
3. **–¢—Ä–∏–≥–≥–µ—Ä –ë–î** —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å–æ —Å–∫–ª–∞–¥–∞:
   ```sql
   UPDATE products SET stock_quantity = stock_quantity - X
   ```
4. **Supabase Realtime** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º:
   ```json
   {
     "event": "UPDATE",
     "table": "orders",
     "new": { "id": "...", "status": "confirmed" },
     "old": { "id": "...", "status": "pending" }
   }
   ```
5. **Frontend** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–µ—à:
   ```typescript
   invalidateAllProducts() // –ö–µ—à —É—Å—Ç–∞—Ä–µ–ª
   ```
6. **TanStack Query** –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ–Ω–µ:
   ```typescript
   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã
   ```
7. **UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** —Å –Ω–æ–≤—ã–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏ ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∞–¥–º–∏–Ω–æ–º

1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –º–µ–Ω—è–µ—Ç —Ü–µ–Ω—É –≤ Supabase Dashboard
2. **Realtime —Å–æ–±—ã—Ç–∏–µ** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–∞–º
3. **Frontend** –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–µ—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
4. **UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** —Å –Ω–æ–≤–æ–π —Ü–µ–Ω–æ–π

---

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ app.vue)

```typescript
// app.vue - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
const { subscribeAll, unsubscribe } = useOrderRealtime()

onMounted(() => subscribeAll())
onUnmounted(() => unsubscribe())
```

### –í—ã–±–æ—Ä–æ—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞

```typescript
// –¢–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã
const { subscribeToOrders } = useOrderRealtime()
subscribeToOrders()

// –¢–æ–ª—å–∫–æ –≥–æ—Å—Ç–µ–≤—ã–µ –∑–∞–∫–∞–∑—ã
const { subscribeToGuestCheckouts } = useOrderRealtime()
subscribeToGuestCheckouts()

// –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–ø—Ä—è–º—É—é
const { subscribeToProducts } = useOrderRealtime()
subscribeToProducts()
```

### –ö–∞—Å—Ç–æ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

```typescript
// –°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
const supabase = useSupabaseClient()

supabase
  .channel('custom-channel')
  .on('postgres_changes', {
    event: '*', // –í—Å–µ —Å–æ–±—ã—Ç–∏—è (INSERT, UPDATE, DELETE)
    schema: 'public',
    table: 'orders',
  }, (payload) => {
    console.log('Order changed:', payload)

    // –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞
    if (payload.eventType === 'DELETE') {
      // –ó–∞–∫–∞–∑ —É–¥–∞–ª—ë–Ω
    }
  })
  .subscribe()
```

---

## üìä –§–∏–ª—å—Ç—Ä—ã —Å–æ–±—ã—Ç–∏–π

### –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–æ–Ω–∫–µ

```typescript
supabase
  .channel('high-priority-orders')
  .on('postgres_changes', {
    event: 'INSERT',
    schema: 'public',
    table: 'orders',
    filter: 'total_amount=gte.100000', // –ó–∞–∫–∞–∑—ã > 100,000 ‚Ç∏
  }, handleEvent)
  .subscribe()
```

### –§–∏–ª—å—Ç—Ä –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —É—Å–ª–æ–≤–∏—è–º

```typescript
// –¢–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
filter: 'status=eq.confirmed&user_id=eq.abc-123'
```

### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤

| –û–ø–µ—Ä–∞—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|--------|
| `eq` | –†–∞–≤–Ω–æ | `status=eq.confirmed` |
| `neq` | –ù–µ —Ä–∞–≤–Ω–æ | `status=neq.cancelled` |
| `gt` | –ë–æ–ª—å—à–µ | `total_amount=gt.50000` |
| `gte` | –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ | `stock_quantity=gte.10` |
| `lt` | –ú–µ–Ω—å—à–µ | `discount=lt.30` |
| `lte` | –ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ | `price=lte.5000` |

---

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö

```typescript
// ‚ùå –ù–µ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
// ‚úÖ –°–æ–±—ã—Ç–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–≤–µ–∂–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É:

```typescript
refetchOnWindowFocus: true // –í TanStack Query
```

### 2. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (RLS)

Realtime —Å–æ–±—ã—Ç–∏—è **—Å–æ–±–ª—é–¥–∞—é—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏**:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã
CREATE POLICY "Users see own orders"
ON orders FOR SELECT
USING (auth.uid() = user_id);
```

–ï—Å–ª–∏ RLS –∑–∞–ø—Ä–µ—â–∞–µ—Ç —á—Ç–µ–Ω–∏–µ ‚Üí —Å–æ–±—ã—Ç–∏–µ **–Ω–µ –ø—Ä–∏–¥—ë—Ç**.

### 3. –õ–∏–º–∏—Ç—ã Supabase

- **Free Plan:** 200 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **Pro Plan:** 500 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –û—Ç–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```typescript
supabase
  .channel('test-channel')
  .on('postgres_changes', {
    event: 'UPDATE',
    schema: 'public',
    table: 'orders',
  }, (payload) => {
    console.log('‚úÖ Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç:', payload)
  })
  .subscribe((status, err) => {
    console.log('Status:', status) // SUBSCRIBED, CLOSED, CHANNEL_ERROR
    if (err) console.error('Error:', err)
  })
```

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üîî Subscribing to orders realtime updates...
‚úÖ Subscribed to orders channel
üîî Order confirmed (realtime): abc-123-def
‚úÖ Product stocks updated (order confirmed)
üîÑ Invalidated ALL product caches
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –≤ –ë–î

```sql
SELECT schemaname, tablename
FROM pg_publication_tables
WHERE pubname = 'supabase_realtime';
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
- `public.orders`
- `public.guest_checkouts`
- `public.products`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```sql
-- –í—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑
UPDATE orders
SET status = 'confirmed'
WHERE id = 'test-order-id';

-- –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç
```

---

## üé® UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ—Å—Ç –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

```typescript
import { toast } from 'vue-sonner'

supabase
  .channel('orders-realtime')
  .on('postgres_changes', {
    event: 'UPDATE',
    schema: 'public',
    table: 'orders',
    filter: 'status=eq.confirmed',
  }, (payload) => {
    invalidateAllProducts()

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    toast.info('–û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', {
      description: `–ó–∞–∫–∞–∑ ‚Ññ${payload.new.id.slice(-6)} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω`
    })
  })
  .subscribe()
```

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```vue
<template>
  <div class="fixed bottom-4 right-4">
    <div v-if="isRealtimeConnected" class="flex items-center gap-2 px-3 py-2 bg-green-100 rounded-lg">
      <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
      <span class="text-sm text-green-700">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞</span>
    </div>
  </div>
</template>

<script setup>
const isRealtimeConnected = ref(false)

supabase
  .channel('status')
  .subscribe((status) => {
    isRealtimeConnected.value = status === 'SUBSCRIBED'
  })
</script>
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
const channel = supabase
  .channel('all-updates')
  .on('postgres_changes', { table: 'orders', event: 'UPDATE' }, handleOrders)
  .on('postgres_changes', { table: 'products', event: 'UPDATE' }, handleProducts)
  .subscribe()

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª–æ–≤
const channel1 = supabase.channel('orders').on(...).subscribe()
const channel2 = supabase.channel('products').on(...).subscribe()
```

### –î–µ–±–∞—É–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```typescript
import { debounce } from 'lodash-es'

const debouncedInvalidate = debounce(() => {
  invalidateAllProducts()
}, 500) // –ú–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 500–º—Å

supabase
  .channel('orders-realtime')
  .on('postgres_changes', {
    event: 'UPDATE',
    schema: 'public',
    table: 'orders',
  }, () => {
    debouncedInvalidate() // –î–µ–±–∞—É–Ω—Å –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  })
  .subscribe()
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π workflow

1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Telegram
2. **Edge Function** –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î (—Å—Ç–∞—Ç—É—Å ‚Üí confirmed)
3. **–¢—Ä–∏–≥–≥–µ—Ä –ë–î** —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã
4. **Realtime** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º (< 100ms)
5. **Frontend** –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–µ—à
6. **TanStack Query** –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
7. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (< 1 —Å–µ–∫—É–Ω–¥—ã)
- üéØ –ú–∏–Ω–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Supabase Realtime Docs](https://supabase.com/docs/guides/realtime)
- [Realtime Filters](https://supabase.com/docs/guides/realtime/postgres-changes#available-filters)
- [Realtime Quotas](https://supabase.com/docs/guides/platform/going-into-prod#realtime-quotas)
