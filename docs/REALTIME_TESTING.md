# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Supabase Realtime

## –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏:

```
üîî Subscribing to orders realtime updates...
üîî Subscribing to guest checkouts realtime updates...
‚úÖ Subscribed to orders channel
‚úÖ Subscribed to guest checkouts channel
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–µ –≤–∫–ª–∞–¥–∫–∏ —Å —Å–∞–π—Ç–æ–º

- **–í–∫–ª–∞–¥–∫–∞ 1:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/catalog/products/lego-city`)
- **–í–∫–ª–∞–¥–∫–∞ 2:** –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/`)

### 3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Telegram

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ (–º–æ–∂–Ω–æ –≥–æ—Å—Ç–µ–≤–æ–π)
2. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"**

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–í –∫–æ–Ω—Å–æ–ª–∏ –æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–æ–∫ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**

```
üîî Order confirmed (realtime): abc-123-def-456
‚úÖ Product stocks updated (order confirmed)
üîÑ Invalidated ALL product caches
```

**–ù–∞ –≤–∫–ª–∞–¥–∫–∞—Ö:**

- –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (< 1 —Å–µ–∫—É–Ω–¥—ã)
- –ë–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ë–µ–∑ —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SQL

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:

```sql
-- –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
SELECT id, name, stock_quantity
FROM products
WHERE stock_quantity > 5
LIMIT 1;
```

–ó–∞–ø–æ–º–Ω–∏—Ç–µ `id` —Ç–æ–≤–∞—Ä–∞.

### 3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑:

```sql
-- –í—Å—Ç–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
INSERT INTO orders (
  user_id,
  total_amount,
  final_amount,
  delivery_method,
  payment_method,
  status
) VALUES (
  NULL, -- –ì–æ—Å—Ç–µ–≤–æ–π –∑–∞–∫–∞–∑
  10000,
  10000,
  'pickup',
  'cash',
  'pending'
) RETURNING id;
```

–ó–∞–ø–æ–º–Ω–∏—Ç–µ `id` –∑–∞–∫–∞–∑–∞.

### 4. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∑–∞–∫–∞–∑:

```sql
INSERT INTO order_items (
  order_id,
  product_id,
  quantity,
  price_per_item,
  bonus_points_per_item
) VALUES (
  '–ó–ê–ö–ê–ó_ID_–ó–î–ï–°–¨',
  '–¢–û–í–ê–†_ID_–ó–î–ï–°–¨',
  2,
  5000,
  50
);
```

### 5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑ (—Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–µ—Ç):

```sql
UPDATE orders
SET status = 'confirmed'
WHERE id = '–ó–ê–ö–ê–ó_ID_–ó–î–ï–°–¨';
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:

```
üîî Order confirmed (realtime): –ó–ê–ö–ê–ó_ID_–ó–î–ï–°–¨
‚úÖ Product stocks updated (order confirmed)
üîÑ Invalidated ALL product caches
```

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Å—Ç–∞—Ç–∫–∏:

```sql
SELECT name, stock_quantity
FROM products
WHERE id = '–¢–û–í–ê–†_ID_–ó–î–ï–°–¨';
```

–û—Å—Ç–∞—Ç–∫–∏ –¥–æ–ª–∂–Ω—ã —É–º–µ–Ω—å—à–∏—Ç—å—Å—è –Ω–∞ 2 —à—Ç—É–∫–∏.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ Realtime

### –í Supabase Dashboard ‚Üí SQL Editor:

```sql
SELECT schemaname, tablename
FROM pg_publication_tables
WHERE pubname = 'supabase_realtime';
```

**–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:**

```
schemaname | tablename
-----------+------------------
public     | orders
public     | guest_checkouts
public     | products
```

---

## –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### Realtime –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**

```typescript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
supabase.getChannels()
// –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
```

**2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:**

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:

```
‚úÖ Subscribed to orders channel
‚úÖ Subscribed to guest checkouts channel
```

–ï—Å–ª–∏ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:

```
‚ùå Error subscribing to orders channel
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —á—Ç–µ–Ω–∏–µ
- –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø—É–±–ª–∏–∫–∞—Ü–∏—é
- –û—à–∏–±–∫–∞ –≤ —Ñ–∏–ª—å—Ç—Ä–µ —Å–æ–±—ã—Ç–∏–π

**3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT tablename, policyname, cmd, qual
FROM pg_policies
WHERE tablename IN ('orders', 'guest_checkouts');
```

**4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ REPLICA IDENTITY:**

```sql
SELECT relname, relreplident
FROM pg_class
WHERE relname IN ('orders', 'guest_checkouts', 'products');
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å `relreplident = 'f'` (FULL).

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A** —Å–º–æ—Ç—Ä–∏—Ç —Ç–æ–≤–∞—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/catalog/products/lego`
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B** –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ —Å —ç—Ç–∏–º —Ç–æ–≤–∞—Ä–æ–º
3. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Telegram
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A** –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ **–¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö** (Chrome + Firefox)
2. –í –ø–µ—Ä–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
3. –í–æ –≤—Ç–æ—Ä–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ —Å —ç—Ç–∏–º —Ç–æ–≤–∞—Ä–æ–º
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Telegram
5. –í –ø–µ—Ä–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –æ—Å—Ç–∞—Ç–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

## –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤:

**Supabase Free Plan:**

- –ú–∞–∫—Å–∏–º—É–º **200 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**

**Supabase Pro Plan:**

- –ú–∞–∫—Å–∏–º—É–º **500 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**

### –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
const channels = []

for (let i = 0; i < 10; i++) {
  const channel = supabase
    .channel(`test-${i}`)
    .on('postgres_changes', {
      event: 'UPDATE',
      schema: 'public',
      table: 'orders',
    }, () => {})
    .subscribe()

  channels.push(channel)
}

// –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –≤—Å–µ—Ö
channels.forEach(ch => supabase.removeChannel(ch))
```

**–í–Ω–∏–º–∞–Ω–∏–µ:** –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–æ—Ç–Ω–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤ production!

---

## –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ:

1. **–ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
   - ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ –∫–∞–Ω–∞–ª—ã
   - üîî –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤
   - üîÑ –ö–µ—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:**
   - –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
   - –ë–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

3. **–ë–î –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞:**
   - –¢–∞–±–ª–∏—Ü—ã –≤ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ `supabase_realtime`
   - REPLICA IDENTITY = FULL
   - –¢—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üéØ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ production
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è Realtime –≤ –ë–î
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ Telegram
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –Ω–∞ –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É (refetchOnWindowFocus)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –æ—Ç–ø–∏—Å–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

---

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç?** üéâ –¢–µ–ø–µ—Ä—å –æ—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!
