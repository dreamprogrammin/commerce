-- Файл: supabase/migrations/20240524100000_fix_menu_items_rls_policy.sql

-- Назначение: Исправление политики безопасности (RLS) для таблицы `menu_items`.
-- Проблема: Существующая политика была настроена некорректно (`USING (7)`),
-- что полностью блокировало публичный доступ на чтение к любым данным из таблицы.
-- Решение: Заменяем некорректную политику на новую, которая разрешает
-- публичное чтение всех строк.

-- Шаг 1: Удаляем старую политику, чтобы избежать конфликтов.
-- `IF EXISTS` гарантирует, что команда не вызовет ошибку, если политики с таким именем нет.
DROP POLICY IF EXISTS "Public can read all menu items" ON public.menu_items;


-- Шаг 2: Создаем новую, правильную политику.
CREATE POLICY "Public can read all menu items"
ON public.menu_items     -- Для таблицы `menu_items`
FOR SELECT               -- Только для операций чтения (`SELECT`)
TO public                -- Для всех публичных ролей (включая неавторизованных пользователей)
USING (true);            -- Условие, которое разрешает доступ. `true` означает "разрешить для всех строк".